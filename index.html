
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Geojit | Customer Preference Survey</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>

  <!-- MoEngage Web SDK (Workspace ID / App ID) -->
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m,n){i.moengage_object=r;t={};q=function(f){return function(){(i.moengage_q=i.moengage_q||[]).push({f:f,a:arguments})}};f=['track_event','add_user_attribute','add_first_name','add_last_name','add_email','add_mobile','add_user_name','add_gender','add_birthday','destroy_session','add_unique_user_id','moe_events','call_web_push','track','location_type_attribute'],h={onsite:["getData","registerCallback"]};for(k in f){t[f[k]]=q(f[k])}for(k in h)for(l in h[k]){null==t[k]&&(t[k]={}),t[k][h[k][l]]=q(k+"."+h[k][l])}a=s.createElement(o);m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);i.moe=i.moe||function(){n=arguments[0];return t};a.onload=function(){if(n){i[r]=moe(n)}}})(window,document,'script','https://cdn.moengage.com/webpush/moe_webSdk.min.latest.js','Moengage');
    window.Moengage = moe({
      app_id: "NIVAUUN9DMI0RXNZ3QKZCUHO",
      debug_logs: 0
    });
  </script>

  <!-- Style reused from the provided index.html -->
  <style>
    body, html {
      font: 400 16px/24px "Open Sans", sans-serif;
      font-optical-sizing: auto;
      min-width: 320px;
      color: #4C4C4C;
      background: #ffffff;
      padding: 10px 0px;
    }
    @media only screen and (max-width: 768px) {
      body, html { font: 400 14px/22px "Open Sans", sans-serif; min-width: 100%; }
    }
    .outer-container { padding: 20px; }
    .container {
      background-color: #F1FDFC;
      border-radius: 12px;
      border: 1px solid #3E877C;
    }
    .header {
      height: 60px;
      margin: 30px 0px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0px 10px;
    }
    .header a { height: 60px; display: flex; align-items: center; justify-content: center; }
    @media only screen and (max-width: 768px) {
      .header { height: 24px; margin: 20px 0px; }
      .header a { height: 24px; }
    }
    .header a img { height: 100%; }
    .header .link {
      text-decoration: none;
      color: #4C4C4C;
      transition: all ease 0.6s;
    }
    .header .link:hover { text-decoration: none; color: #3E877C; }
    .title {
      font-size: 26px;
      font-weight: 600;
      line-height: 34px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      margin-bottom: 16px;
      padding: 0px 10px;
      text-align: center;
    }
    .description {
      font-size: 18px;
      font-weight: 400;
      line-height: 30px;
      margin-bottom: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0px 60px;
    }
    .salutation {
      font-size: 18px;
      font-weight: 400;
      line-height: 30px;
      margin-bottom: 20px;
      text-align: left;
      padding: 0px 10px;
    }
    @media only screen and (max-width: 768px) {
      .title { font-size: 18px; line-height: 24px; margin-bottom: 10px; }
      .description { font-size: 16px; line-height: 22px; margin-bottom: 26px; padding: 0px 10px; }
      .salutation { margin-bottom: 16px; }
    }

    .survey-form { width: 100%; padding: 0px 10px 10px; }
    ol { padding-left: 0px; }
    ol > li::marker { font-weight: 600; }
    ol li { font-size: 16px; line-height: 20px; font-weight: 400; padding-left: 16px; margin-left: 20px; margin-bottom: 22px; }
    ol li label { font-size: 16px; line-height: 20px; font-weight: 400; margin-bottom: 14px; }
    @media only screen and (max-width: 768px) {
      ol li, ol li label { font-size: 14px; line-height: 18px; color: #4c4c4c; margin-bottom: 12px; }
      ol li { padding-left: 12px; }
    }
    .labelstrong { font-weight: 600; }
    ol li .sublabel { font-size: 14px; line-height: 18px; font-weight: 400; }
    ol li p { margin-bottom: 0px; }

    .formGroup { display: flex; align-items: center; justify-content: flex-start; flex-wrap: wrap; }
    @media only screen and (max-width: 1200px) {
      .formGroup { flex-direction: column; justify-content: flex-start; align-items: flex-start; }
    }

    /* Custom radio/checkbox (matches existing look) */
    [type="radio"], [type="checkbox"] { position: absolute; left: -9999px; }
    [type="radio"] + label, [type="checkbox"] + label {
      position: relative;
      padding-left: 28px;
      cursor: pointer;
      line-height: 20px;
      display: inline-block;
      color: #4c4c4c;
      margin-right: 30px;
      margin-bottom: 10px;
    }
    /* radio */
    [type="radio"] + label:before {
      content: '';
      position: absolute; left: 0; top: 0;
      width: 20px; height: 20px;
      border: 1px solid #d7d7d7; border-radius: 100%;
      background: #fff;
    }
    [type="radio"]:checked + label:before { border: 1px solid #3E877C; }
    [type="radio"] + label:after {
      content: '';
      width: 14px; height: 14px;
      background: #3E877C;
      position: absolute; top: 3px; left: 3px;
      border-radius: 100%;
      transition: all 0.2s ease;
      opacity: 0; transform: scale(0);
    }
    [type="radio"]:checked + label:after { opacity: 1; transform: scale(1); }

    /* checkbox */
    [type="checkbox"] + label:before {
      content: '';
      position: absolute; left: 0; top: 0;
      width: 20px; height: 20px;
      border: 1px solid #d7d7d7; border-radius: 4px;
      background: #fff;
    }
    [type="checkbox"]:checked + label:before { border: 1px solid #3E877C; background: #3E877C; }
    [type="checkbox"] + label:after {
      content: '';
      position: absolute;
      left: 6px; top: 3px;
      width: 6px; height: 12px;
      border: solid #fff;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
      opacity: 0;
    }
    [type="checkbox"]:checked + label:after { opacity: 1; }

    .helptext { font-size: 12px; color: #6b6b6b; margin-top: -8px; margin-bottom: 10px; }

    .button-container { display: flex; padding: 20px; padding-bottom: 5px; align-items: center; justify-content: center; }
    .btn.btn-primary {
      background-color: #f5cf47 !important;
      font-size: .875rem;
      padding: 0.5rem 1.5rem !important;
      border: 2px solid #f5cf47 !important;
      color: #3c3c3c !important;
      outline: 0;
    }
    .btn:focus, .btn.btn-primary:focus { outline: none; box-shadow: none; }
    .successMsg { display: flex; padding: 0px 10px 10px; align-items: center; justify-content: center; margin-bottom: 20px; color: #3E877C; text-align:center; }
    .errorMsg { display: none; padding: 0px 10px 10px; align-items: center; justify-content: center; margin-bottom: 10px; color: #b00020; text-align:center; }
  
    /* Typeform-like wizard UX */
    .survey_steps { margin: 0; padding: 0; }
    .question-step { display:none; list-style:none; padding: 18px 10px; }
    .question-step.active { display:block; animation: fadeInUp .25s ease; }
    @keyframes fadeInUp { from { opacity:0; transform: translateY(6px);} to { opacity:1; transform: translateY(0);} }
    .labelstrong { font-size: 18px; line-height: 26px; margin-bottom: 14px; }
    @media only screen and (max-width: 768px) { .labelstrong { font-size: 16px; line-height: 24px; } }
    .wizard-actions { display:flex; gap:12px; justify-content: space-between; align-items:center; }
    .wizard-actions .btn { flex:1; }
    .wizard-actions #btnBack { max-width: 160px; flex: 0 0 auto; }
    .progress-wrap { padding: 0 10px 10px 10px; }
    .progress-meta { display:flex; justify-content: space-between; align-items: baseline; margin-bottom: 8px; }
    .step-count { font-weight: 700; color:#3E877C; }
    .step-hint { font-size: 12px; opacity: .8; }
    .option-card {
      border: 1px solid rgba(62,135,124,.35);
      background: #ffffff;
      border-radius: 12px;
      padding: 12px 12px;
      margin: 10px 0;
      cursor: pointer;
      transition: transform .08s ease, box-shadow .12s ease, border-color .12s ease;
      display:flex; align-items:flex-start; gap:10px;
    }
    .option-card:hover { transform: translateY(-1px); box-shadow: 0 8px 22px rgba(0,0,0,.06); border-color: rgba(62,135,124,.55); }
    .option-card input { margin-top: 4px; }
    .option-card.selected { border-color: #3E877C; box-shadow: 0 10px 26px rgba(62,135,124,.18); }
    .helptext { margin-top: -8px; margin-bottom: 10px; }

  </style>
</head>

<body>
  
  <script>
    // --- URL helpers (personalization + attribution) ---
    function getQueryParam(param) {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const v = urlParams.get(param);
        return v ? v.trim() : "";
      } catch (e) {
        return "";
      }
    }

    function safeText(el, text) {
      if (!el) return;
      el.textContent = text;
    }

    // Read name / identity from URL and personalize the page header.
    document.addEventListener("DOMContentLoaded", function () {
      const name = getQueryParam("name");     // e.g., ?name=Anitha
      const email = getQueryParam("email");   // optional
      const mobile = getQueryParam("mobile"); // optional

      // Personalize salutation
      const nameEl = document.getElementById("userName");
      if (nameEl) {
        safeText(nameEl, name || "Valued Client");
      }

      // Optional: identify user in MoEngage for persistent profile mapping.
      // Note: MoEngage ties attributes to an anonymous device unless an identity is provided.
      try {
        if (window.Moengage && (email || mobile)) {
          if (typeof window.Moengage.identify_user === "function") {
            // Newer Web SDKs
            window.Moengage.identify_user(Object.assign(
              {},
              email ? { email: email } : null,
              mobile ? { mobile: mobile } : null
            ));
          } else if (typeof window.Moengage.identify === "function") {
            // Some SDK builds expose identify()
            window.Moengage.identify(Object.assign(
              {},
              email ? { email: email } : null,
              mobile ? { mobile: mobile } : null
            ));
          }
          // Store name as user attribute (optional, but useful)
          if (name && typeof window.Moengage.add_user_attribute === "function") {
            window.Moengage.add_user_attribute("name", name);
          }
        }
      } catch (err) {
        console.warn("MoEngage identify/personalization error:", err);
      }
    });
  </script>
<div class="outer-container">
    <div class="container">
      <div class="header">
        <a href="https://www.geojit.com/" target="_blank" class="link">www.geojit.com</a>
        <a href="https://www.geojit.com/" target="_blank">
          <img src="https://www.geojit.com/img/Geojit_logo.svg" alt="Geojit" title="Geojit">
        </a>
      </div>

      <div class="title">
        <span>Customer Preference Survey</span>
      </div>
      <div class="description">
        Help us understand your investing needs and preferences. It takes less than 2 minutes.
      </div>

      <div class="salutation" id="salutationLine">Dear <span id="userName">Valued Client</span>,</div>

      <form class="survey-form" id="survey" name="survey" novalidate>
        <div class="errorMsg" id="errorMsg">Please answer all required questions.</div>

        <div id="survey_steps" class="survey_steps">
          <div class="question-step" data-step="1" id="q1">
            <label class="labelstrong">What best describes you today?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q1_1" name="q1_investor_stage" value="New to investing (mutual funds/stocks)" required><label for="q1_1" class="sublabel">New to investing (mutual funds/stocks)</label></div>
              <div class="option-card"><input type="radio" id="q1_2" name="q1_investor_stage" value="Some experience, still learning"><label for="q1_2" class="sublabel">Some experience, still learning</label></div>
              <div class="option-card"><input type="radio" id="q1_3" name="q1_investor_stage" value="Already invested, want to optimize"><label for="q1_3" class="sublabel">Already invested, want to optimize</label></div>
              <div class="option-card"><input type="radio" id="q1_4" name="q1_investor_stage" value="Experienced trader/investor seeking advanced strategies"><label for="q1_4" class="sublabel">Experienced trader/investor seeking advanced strategies</label></div>
            </div>
          </div>

          <div class="question-step" data-step="2" id="q2">
            <label class="labelstrong">What are you primarily investing for?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q2_1" name="q2_primary_goal" value="Long-term wealth creation" required><label for="q2_1" class="sublabel">Long-term wealth creation</label></div>
              <div class="option-card"><input type="radio" id="q2_2" name="q2_primary_goal" value="Regular income with stability (dividends, interest, payouts)"><label for="q2_2" class="sublabel">Regular income with stability (dividends, interest, payouts)</label></div>
              <div class="option-card"><input type="radio" id="q2_3" name="q2_primary_goal" value="Capital protection with steady growth"><label for="q2_3" class="sublabel">Capital protection with steady growth</label></div>
              <div class="option-card"><input type="radio" id="q2_4" name="q2_primary_goal" value="A specific future goal (education, retirement, home, etc.)"><label for="q2_4" class="sublabel">A specific future goal (education, retirement, home, etc.)</label></div>
              <div class="option-card"><input type="radio" id="q2_5" name="q2_primary_goal" value="Short-term opportunities / trading gains"><label for="q2_5" class="sublabel">Short-term opportunities / trading gains</label></div>
            </div>
          </div>

          <div class="question-step" data-step="3" id="q3">
            <label class="labelstrong">What is your risk profile?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q3_1" name="q3_risk_profile" value="Conservative (Low Risk)" required><label for="q3_1" class="sublabel">Conservative (Low Risk)</label></div>
              <div class="option-card"><input type="radio" id="q3_2" name="q3_risk_profile" value="Moderate (Balanced Risk)"><label for="q3_2" class="sublabel">Moderate (Balanced Risk)</label></div>
              <div class="option-card"><input type="radio" id="q3_3" name="q3_risk_profile" value="Aggressive (High Risk)"><label for="q3_3" class="sublabel">Aggressive (High Risk)</label></div>
            </div>
          </div>

          <div class="question-step" data-step="4" id="q4">
            <label class="labelstrong">How do you usually react to market ups and downs?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q4_1" name="q4_market_reaction" value="Try to avoid losses" required><label for="q4_1" class="sublabel">Try to avoid losses</label></div>
              <div class="option-card"><input type="radio" id="q4_2" name="q4_market_reaction" value="Okay with some ups and downs"><label for="q4_2" class="sublabel">Okay with some ups and downs</label></div>
              <div class="option-card"><input type="radio" id="q4_3" name="q4_market_reaction" value="Comfortable with volatility"><label for="q4_3" class="sublabel">Comfortable with volatility</label></div>
              <div class="option-card"><input type="radio" id="q4_4" name="q4_market_reaction" value="Actively seek high-risk/high-reward opportunities"><label for="q4_4" class="sublabel">Actively seek high-risk/high-reward opportunities</label></div>
            </div>
          </div>

          <div class="question-step" data-step="5" id="q5">
            <label class="labelstrong">What is your investment horizon?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q5_1" name="q5_horizon" value="Less than 1 year (short-term trading/speculation)" required><label for="q5_1" class="sublabel">Less than 1 year (short-term trading/speculation)</label></div>
              <div class="option-card"><input type="radio" id="q5_2" name="q5_horizon" value="1–3 years"><label for="q5_2" class="sublabel">1–3 years</label></div>
              <div class="option-card"><input type="radio" id="q5_3" name="q5_horizon" value="3–5 years"><label for="q5_3" class="sublabel">3–5 years</label></div>
              <div class="option-card"><input type="radio" id="q5_4" name="q5_horizon" value="5–7 years"><label for="q5_4" class="sublabel">5–7 years</label></div>
              <div class="option-card"><input type="radio" id="q5_5" name="q5_horizon" value="7+ years (long-term compounding)"><label for="q5_5" class="sublabel">7+ years (long-term compounding)</label></div>
            </div>
          </div>

          <div class="question-step" data-step="6" id="q6">
            <label class="labelstrong">What kind of investment do you prefer?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q6_1" name="q6_investment_preference" value="Stable & predictable (fixed income, conservative funds)" required><label for="q6_1" class="sublabel">Stable & predictable (fixed income, conservative funds)</label></div>
              <div class="option-card"><input type="radio" id="q6_2" name="q6_investment_preference" value="Balanced growth (diversified portfolio)"><label for="q6_2" class="sublabel">Balanced growth (diversified portfolio)</label></div>
              <div class="option-card"><input type="radio" id="q6_3" name="q6_investment_preference" value="High growth (equities, aggressive funds)"><label for="q6_3" class="sublabel">High growth (equities, aggressive funds)</label></div>
              <div class="option-card"><input type="radio" id="q6_4" name="q6_investment_preference" value="Active trading (stocks, derivatives, baskets)"><label for="q6_4" class="sublabel">Active trading (stocks, derivatives, baskets)</label></div>
            </div>
          </div>

          <div class="question-step" data-step="7" id="q7">
            <label class="labelstrong">How often would you like to invest?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q7_1" name="q7_invest_frequency" value="Monthly" required><label for="q7_1" class="sublabel">Monthly</label></div>
              <div class="option-card"><input type="radio" id="q7_2" name="q7_invest_frequency" value="Quarterly / semi-annual"><label for="q7_2" class="sublabel">Quarterly / semi-annual</label></div>
              <div class="option-card"><input type="radio" id="q7_3" name="q7_invest_frequency" value="Occasionally, when markets look attractive"><label for="q7_3" class="sublabel">Occasionally, when markets look attractive</label></div>
              <div class="option-card"><input type="radio" id="q7_4" name="q7_invest_frequency" value="One-time investment"><label for="q7_4" class="sublabel">One-time investment</label></div>
              <div class="option-card"><input type="radio" id="q7_5" name="q7_invest_frequency" value="Frequent trading"><label for="q7_5" class="sublabel">Frequent trading</label></div>
            </div>
          </div>

          <div class="question-step" data-step="8" id="q8">
            <label class="labelstrong">How hands-on do you want to be with your investments?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q8_1" name="q8_hands_on" value="Actively manage (research, trade, rebalance)" required><label for="q8_1" class="sublabel">Actively manage (research, trade, rebalance)</label></div>
              <div class="option-card"><input type="radio" id="q8_2" name="q8_hands_on" value="Mostly automatic (managed funds, robo-advisors)"><label for="q8_2" class="sublabel">Mostly automatic (managed funds, robo-advisors)</label></div>
              <div class="option-card"><input type="radio" id="q8_3" name="q8_hands_on" value="Fully hassle-free (professional advisory, passive funds)"><label for="q8_3" class="sublabel">Fully hassle-free (professional advisory, passive funds)</label></div>
            </div>
          </div>

          <div class="question-step" data-step="9" id="q9">
            <label class="labelstrong">Which asset classes interest you most?</label>
            <div class="helptext">You may select more than one.</div>
            <div class="formGroup">
              <div class="option-card"><input type="checkbox" id="q9_1" name="q9_asset_classes" value="Equities (stocks, baskets, ETFs)"><label for="q9_1" class="sublabel">Equities (stocks, baskets, ETFs)</label></div>
              <div class="option-card"><input type="checkbox" id="q9_2" name="q9_asset_classes" value="Debt / bonds / fixed income"><label for="q9_2" class="sublabel">Debt / bonds / fixed income</label></div>
              <div class="option-card"><input type="checkbox" id="q9_3" name="q9_asset_classes" value="Bullion"><label for="q9_3" class="sublabel">Bullion</label></div>
              <div class="option-card"><input type="checkbox" id="q9_4" name="q9_asset_classes" value="Others (commodities, REITs, crypto etc.)"><label for="q9_4" class="sublabel">Others (commodities, REITs, crypto etc.)</label></div>
            </div>
          </div>

          <div class="question-step" data-step="10" id="q10">
            <label class="labelstrong">How comfortable are you with digital platforms for investing?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q10_1" name="q10_digital_comfort" value="Prefer human advisor / offline" required><label for="q10_1" class="sublabel">Prefer human advisor / offline</label></div>
              <div class="option-card"><input type="radio" id="q10_2" name="q10_digital_comfort" value="Okay with apps but need guidance"><label for="q10_2" class="sublabel">Okay with apps but need guidance</label></div>
              <div class="option-card"><input type="radio" id="q10_3" name="q10_digital_comfort" value="Comfortable with online platforms"><label for="q10_3" class="sublabel">Comfortable with online platforms</label></div>
              <div class="option-card"><input type="radio" id="q10_4" name="q10_digital_comfort" value="Advanced — use screeners, robo-advisors, trading tools"><label for="q10_4" class="sublabel">Advanced — use screeners, robo-advisors, trading tools</label></div>
            </div>
          </div>

          <div class="question-step" data-step="11" id="q11">
            <label class="labelstrong">Would you like to use AI-driven recommendations?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q11_1" name="q11_ai_reco" value="Yes — open to automated suggestions" required><label for="q11_1" class="sublabel">Yes — open to automated suggestions</label></div>
              <div class="option-card"><input type="radio" id="q11_2" name="q11_ai_reco" value="Maybe — but want human validation"><label for="q11_2" class="sublabel">Maybe — but want human validation</label></div>
              <div class="option-card"><input type="radio" id="q11_3" name="q11_ai_reco" value="No — prefer manual decision-making"><label for="q11_3" class="sublabel">No — prefer manual decision-making</label></div>
            </div>
          </div>

          <div class="question-step" data-step="12" id="q12">
            <label class="labelstrong">Do you prefer passive investing, active investing, or a hybrid approach?</label>
            <div class="formGroup">
              <div class="option-card"><input type="radio" id="q12_1" name="q12_style" value="Passive investing (index funds, ETFs)" required><label for="q12_1" class="sublabel">Passive investing (index funds, ETFs)</label></div>
              <div class="option-card"><input type="radio" id="q12_2" name="q12_style" value="Active investing (stock picking, trading)"><label for="q12_2" class="sublabel">Active investing (stock picking, trading)</label></div>
              <div class="option-card"><input type="radio" id="q12_3" name="q12_style" value="Hybrid approach (mix of both)"><label for="q12_3" class="sublabel">Hybrid approach (mix of both)</label></div>
            </div>
          </div>
        </div>

        <div class="progress-wrap">
  <div class="progress-meta">
    <div class="step-count"><span id="stepNum">1</span> / <span id="stepTotal">12</span></div>
    <div class="step-hint" id="stepHint">Select an option to continue</div>
  </div>
  <div class="progress" style="height:8px; border-radius:999px; overflow:hidden;">
    <div class="progress-bar" id="progressBar" role="progressbar" style="width:0%"></div>
  </div>
</div>

<div class="button-container wizard-actions">
  <button type="button" class="btn btn-secondary" id="btnBack">Back</button>
  <button type="button" class="btn btn-primary" id="btnNext">Next</button>
  <button type="submit" class="btn btn-primary" id="geojitSurveySubmit" style="display:none;">Submit</button>
</div>
        <div class="successMsg" id="successMsg"></div>
      </form>

      <!-- Thank you modal (same UX pattern as your existing page) -->
      <div class="modal fade" id="thankYouModal" tabindex="-1" aria-labelledby="thankYouModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="thankYouModalLabel">Thank you!</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" id="thankyou-body">
              Thank you for participating in the survey! Your feedback helps us serve you better.
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    function getFormData(form) {
      const data = {};
      // radios
      const radioGroups = new Set([...form.querySelectorAll('input[type="radio"]')].map(r => r.name));
      radioGroups.forEach(name => {
        const checked = form.querySelector('input[type="radio"][name="'+name+'"]:checked');
        data[name] = checked ? checked.value : "";
      });

      // checkboxes (multi)
      const checkboxGroups = new Set([...form.querySelectorAll('input[type="checkbox"]')].map(c => c.name));
      checkboxGroups.forEach(name => {
        const checked = [...form.querySelectorAll('input[type="checkbox"][name="'+name+'"]:checked')].map(x => x.value);
        data[name] = checked;
      });

      return data;
    }

    function validateRequiredRadios(form) {
      const requiredNames = new Set(
        [...form.querySelectorAll('input[type="radio"][required]')].map(r => r.name)
      );
      for (const name of requiredNames) {
        if (!form.querySelector('input[type="radio"][name="'+name+'"]:checked')) return false;
      }
      // Q9: ensure at least one checkbox selected
      const q9Checked = form.querySelectorAll('input[type="checkbox"][name="q9_asset_classes"]:checked').length;
      if (q9Checked === 0) return false;

      return true;
    }

    const form = document.getElementById('survey');
    // Wizard (one question at a time)
    const steps = Array.from(document.querySelectorAll('.question-step'));
    const totalSteps = steps.length;
    const stepNumEl = document.getElementById('stepNum');
    const stepTotalEl = document.getElementById('stepTotal');
    const progressBar = document.getElementById('progressBar');
    const btnNext = document.getElementById('btnNext');
    const btnBack = document.getElementById('btnBack');
    const stepHint = document.getElementById('stepHint');

    stepTotalEl.textContent = String(totalSteps);

    let currentStep = 0;

    function updateOptionCardSelection(stepEl) {
      const cards = stepEl.querySelectorAll('.option-card');
      cards.forEach(card => {
        const input = card.querySelector('input');
        const selected = input && ((input.type === 'radio' && input.checked) || (input.type === 'checkbox' && input.checked));
        card.classList.toggle('selected', !!selected);
      });
    }

    function showStep(index) {
      steps.forEach((s,i) => s.classList.toggle('active', i === index));
      currentStep = index;
      stepNumEl.textContent = String(index + 1);
      const pct = Math.round(((index) / (totalSteps - 1)) * 100);
      progressBar.style.width = (isFinite(pct) ? pct : 0) + '%';

      // buttons
      btnBack.style.visibility = index === 0 ? 'hidden' : 'visible';

      // Show submit only on last step
      const isLast = index === totalSteps - 1;
      document.getElementById('geojitSurveySubmit').style.display = isLast ? 'inline-block' : 'none';
      btnNext.style.display = isLast ? 'none' : 'inline-block';

      // reset messages
      document.getElementById('errorMsg').style.display = 'none';
      stepHint.textContent = 'Select an option to continue';

      updateOptionCardSelection(steps[index]);

      // focus first input
      const firstInput = steps[index].querySelector('input');
      if (firstInput) firstInput.focus({preventScroll:true});

      // scroll to top of card
      const container = document.querySelector('.container');
      if (container) container.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function stepAnswered(stepEl) {
      const radios = stepEl.querySelectorAll('input[type="radio"]');
      if (radios.length) {
        const name = radios[0].name;
        return !!form.querySelector('input[type="radio"][name="'+name+'"]:checked');
      }
      const checks = stepEl.querySelectorAll('input[type="checkbox"]');
      if (checks.length) {
        // For Q9 we require at least one selection
        return stepEl.querySelectorAll('input[type="checkbox"]:checked').length > 0;
      }
      return true;
    }

    function validateStep(index) {
      const stepEl = steps[index];
      const ok = stepAnswered(stepEl);
      if (!ok) {
        document.getElementById('errorMsg').style.display = 'flex';
        stepHint.textContent = 'Please choose at least one option';
      }
      return ok;
    }

    // Make option cards clickable
    document.querySelectorAll('.option-card').forEach(card => {
      card.addEventListener('click', (e) => {
        const input = card.querySelector('input');
        if (!input) return;
        if (input.type === 'radio') {
          input.checked = true;
        } else if (input.type === 'checkbox') {
          input.checked = !input.checked;
        }
        input.dispatchEvent(new Event('change', { bubbles: true }));
      });
    });

    // On change, update selection and enable next vibe
    form.addEventListener('change', (e) => {
      const active = steps[currentStep];
      if (!active.contains(e.target)) return;
      updateOptionCardSelection(active);
      document.getElementById('errorMsg').style.display = 'none';
      stepHint.textContent = 'Looks good — click Next';
    });

    btnNext.addEventListener('click', () => {
      if (!validateStep(currentStep)) return;
      showStep(Math.min(currentStep + 1, totalSteps - 1));
    });

    btnBack.addEventListener('click', () => {
      showStep(Math.max(currentStep - 1, 0));
    });

    // Enter key = Next (except on last step)
    document.addEventListener('keydown', (e) => {
      if (e.key !== 'Enter') return;
      const isLast = currentStep === totalSteps - 1;
      if (isLast) return;
      // prevent accidental submit note
      e.preventDefault();
      btnNext.click();
    });

    // init
    showStep(0);

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      document.getElementById('successMsg').innerText = "";
      document.getElementById('errorMsg').style.display = "none";

      if (!validateRequiredRadios(form)) {
        document.getElementById('errorMsg').style.display = "flex";
        window.scrollTo({ top: 0, behavior: 'smooth' });
        return;
      }

      const payload = getFormData(form);

      // --- MoEngage tracking ---
      // NOTE: We store attributes WITHOUT the q1/q2 prefixes (those are only internal identifiers).
      // Event name: customer_preference
      // Event attributes + user attributes:
      // experience, purpose, risk, reaction, horizon, preference, frequency, involvement, assets, digital, ai, approach
      const moeAttributes = {
        name: (getQueryParam('name') || ''),
        email: (getQueryParam('email') || ''),
        mobile: (getQueryParam('mobile') || ''),
        utm_source: (getQueryParam('utm_source') || ''),
        utm_medium: (getQueryParam('utm_medium') || ''),
        utm_campaign: (getQueryParam('utm_campaign') || ''),
        utm_content: (getQueryParam('utm_content') || ''),
        utm_term: (getQueryParam('utm_term') || ''),
        experience: payload.q1_investor_stage || "",
        purpose: payload.q2_primary_goal || "",
        risk: payload.q3_risk_profile || "",
        reaction: payload.q4_market_reaction || "",
        horizon: payload.q5_horizon || "",
        preference: payload.q6_investment_preference || "",
        frequency: payload.q7_invest_frequency || "",
        involvement: payload.q8_hands_on || "",
        assets: Array.isArray(payload.q9_asset_classes) ? payload.q9_asset_classes : (payload.q9_asset_classes ? [payload.q9_asset_classes] : []),
        digital: payload.q10_digital_comfort || "",
        ai: payload.q11_ai_reco || "",
        approach: payload.q12_style || ""
      };

      // Track event with attributes
      try {
        if (window.Moengage && typeof window.Moengage.track_event === 'function') {
          window.Moengage.track_event('customer_preference', moeAttributes);
        }
        // Persist answers as user attributes (recommended: identify user for cross-device persistence)
        if (window.Moengage && typeof window.Moengage.add_user_attribute === 'function') {
          const answerKeys = ['experience','purpose','risk','reaction','horizon','preference','frequency','involvement','assets','digital','ai','approach'];
          answerKeys.forEach((key) => {
            window.Moengage.add_user_attribute(key, moeAttributes[key]);
          });
        }
      } catch (err) {
        console.warn('MoEngage tracking error:', err);
      }

      console.log("Survey payload:", payload);
      console.log("MoEngage attributes:", moeAttributes);

      // UX: disable submit to prevent repeat submits
      document.getElementById('geojitSurveySubmit').disabled = true;

      $('#thankYouModal').modal('toggle');
      document.getElementById('successMsg').innerText = "Submitted successfully.";
    });
  </script>
</body>
</html>
